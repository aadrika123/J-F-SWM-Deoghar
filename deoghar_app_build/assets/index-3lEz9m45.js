import{g as o,j as e,_ as ee}from"./index-D9SUnkI2.js";import{h as ae}from"./moment-BjLXg0w5.js";import{a as me,o as ce,F as xe,S as se,c as he,b as t}from"./SelectField-WJfBqNjK.js";import{R as l}from"./RHFTextField-BdHjFRnA.js";import{B as oe}from"./button-IjAY8dzr.js";import{b as je,f as pe}from"./router-DQohkvhc.js";import{P as Ne}from"./index-BhPwl-Wc.js";import{C as m,b as c}from"./card-BocCdTs6.js";import{T as ue,a as be,b as de,c as j,d as ye,e as p,H as fe}from"./table-CvgRke4_.js";import{u as ve,b as ge,a as te}from"./useCustomQuery-DgvKAbQU.js";import{S as N}from"./separator-ZtTJhbg_.js";import{S as u}from"./SkeletonLoader-wDDYqom2.js";import{I as Ce}from"./Image-C1TMCRx8.js";import{C as we}from"./index-DIInLEzD.js";import{O as Me}from"./OverLayLoader-B_NdIHLb.js";import"./headlessui-qWRqSxHB.js";import"./axios-DmypytPv.js";import"./module-CLOPZauA.js";const qe=he().shape({paymentMode:t().required("Payment mode is required"),paidUpto:t().required("Payment amount is required"),bankName:t().when("paymentMode",{is:"Dd",then:()=>t()}),branchName:t().when("paymentMode",{is:"Dd",then:()=>t()}),chequeDate:t().when("paymentMode",{is:"Dd",then:()=>t()}),chequeNo:t().when("paymentMode",{is:"Dd",then:()=>t()})});function ze(){var b,y,f,v,g,C,w,M,q,P,A,D,S,U,k,B,F,T,Y,_,I,L,$,H,R,O,E,z,G,J,K,Q;const ne=je(),{mutateAsync:le,isPending:ie}=ve({}),{id:n}=pe(),a=ge({api:`${o.getConsumerDetailsById}/${n}`,options:{enabled:!!n}}),r=me({resolver:ce(qe)}),x=te({api:o.getPaymentData,config:{consumerId:n},options:{enabled:!!n}}),i=te({api:o.getCalculatedAmount,config:{consumerId:n,payUpto:r.watch("paidUpto")},value:[r.watch("paidUpto")],options:{enabled:!!r.watch("paidUpto")&&!!n}}),re=async s=>{we("Are you sure to pay?","Please confirm",async()=>{var h,V,W,X,Z;try{const d=await le({api:o.postPayment,data:s.paymentMode==="Cash"?{consumerId:n,paidAmount:(h=i.data)==null?void 0:h.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto}:{consumerId:n,paidAmount:(V=i.data)==null?void 0:V.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto,bankName:s.bankName,branchName:s.branchName,chequeNo:s.chequeNo,chequeDate:s.chequeDate}});(W=d==null?void 0:d.data)!=null&&W.status?(ee.success(d==null?void 0:d.data.msg),ne(`/deoghar-app/payment-receipt/${(Z=(X=d==null?void 0:d.data)==null?void 0:X.data)==null?void 0:Z.transactionNo}`,{replace:!0})):ee.error(d==null?void 0:d.data.msg)}catch{}})};return a!=null&&a.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(m,{children:e.jsxs(c,{children:[e.jsx(u,{}),e.jsx(u,{}),e.jsx(u,{})]})})}):e.jsxs(Ne,{title:"Consumer Payment",children:[ie&&e.jsx(Me,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(Ce,{src:"/assets/image/category.png",alt:"Consumer Payment",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"font-semibold",children:"Consumer Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Consumer payment details here."})]})]}),e.jsx(N,{}),e.jsx(m,{children:e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(y=(b=a==null?void 0:a.data)==null?void 0:b.data[0])==null?void 0:y.consumerNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(v=(f=a==null?void 0:a.data)==null?void 0:f.data[0])==null?void 0:v.consumerName})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Mobile:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(C=(g=a==null?void 0:a.data)==null?void 0:g.data[0])==null?void 0:C.mobileNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(M=(w=a==null?void 0:a.data)==null?void 0:w.data[0])==null?void 0:M.monthlyDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(P=(q=a==null?void 0:a.data)==null?void 0:q.data[0])==null?void 0:P.totalDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand upto:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(D=(A=a==null?void 0:a.data)==null?void 0:A.data[0])==null?void 0:D.demandUpto})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand from:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(U=(S=a==null?void 0:a.data)==null?void 0:S.data[0])==null?void 0:U.demandFrom})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer type:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(B=(k=a==null?void 0:a.data)==null?void 0:k.data[0])==null?void 0:B.cansumerType})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(T=(F=a==null?void 0:a.data)==null?void 0:F.data[0])==null?void 0:T.Address})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply Date:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(_=(Y=a==null?void 0:a.data)==null?void 0:Y.data[0])==null?void 0:_.applyDate})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply By:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(L=(I=a==null?void 0:a.data)==null?void 0:I.data[0])==null?void 0:L.applyBy})})]})})}),e.jsx(N,{}),((R=(H=($=a==null?void 0:a.data)==null?void 0:$.data[0])==null?void 0:H.activeDemandDetails)==null?void 0:R.length)>0?e.jsxs(e.Fragment,{children:[" ",e.jsx(m,{children:e.jsx(c,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(N,{}),e.jsx("div",{children:e.jsxs(ue,{children:[e.jsx(be,{children:e.jsxs(de,{children:[e.jsx(j,{children:"Demand from"}),e.jsx(j,{children:"Demand upto"}),e.jsx(j,{children:"Amount"}),e.jsx(j,{children:"Status"})]})}),e.jsx(ye,{children:(z=(E=(O=a==null?void 0:a.data)==null?void 0:O.data[0])==null?void 0:E.activeDemandDetails)==null?void 0:z.map((s,h)=>e.jsxs(de,{children:[e.jsx(p,{children:ae(s.payment_from).format("DD-MMM-YYYY")}),e.jsx(p,{children:ae(s.payment_to).format("DD-MMM-YYYY")}),e.jsx(p,{children:s.total_tax}),e.jsx(p,{children:s.paid_status==0?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},h+1))})]})})]})})}),e.jsx(N,{}),e.jsx(m,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(c,{children:e.jsxs(xe,{methods:r,onSubmit:r.handleSubmit(re),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(se,{name:"paidUpto",label:"Payment Amount",className:"w-full",data:((K=(J=(G=x==null?void 0:x.data)==null?void 0:G.data)==null?void 0:J.demand)==null?void 0:K.map(s=>({label:String(s.payment_to),value:String(s.payment_to)})))??[]})}),e.jsx("div",{children:e.jsx(se,{name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(l,{name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{type:"date",name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(l,{name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{name:"chequeDate",type:"date",label:"DD Date",className:"w-full"})})]})}[r.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(oe,{type:"submit",className:"mx-auto",disabled:i.isLoading||x.isLoading,children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),i!=null&&i.isLoading?"Calculating...":`Pay Now â‚¹ ${((Q=i.data)==null?void 0:Q.data.totaldemand)??0}`]})})]})})})]}):e.jsx(m,{children:e.jsx(c,{children:e.jsx("div",{className:"py-2 flex justify-center items-center",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{ze as default};
