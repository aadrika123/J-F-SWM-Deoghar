import{d as h,j as e,B as Y,C as Z,_ as y}from"./index-B_v-j40X.js";import{P as B}from"./index-FbMcgR7M.js";import{C as G,b as D}from"./card-enBYYr3Y.js";import{c as ee,a as d,u as ae,F as re,S as p,o as se}from"./SelectField-BWClljsD.js";import{R as x}from"./RHFTextField-D-vBSpWy.js";import{d as te,r as C}from"./router-CTqkcgir.js";import{a as de,u as ne,b as oe}from"./useComonData-BhsWIGuS.js";import{I as ie}from"./Image-DiFkibCW.js";import{S as me}from"./separator-BrhdNTyV.js";import{u as le}from"./useMonthMap-C8hLMgQU.js";import{u as ce,b as w}from"./useCustomQuery-CkotDW_c.js";import{O as ue}from"./OverLayLoader-DpjmM_1y.js";import"./headlessui-BV7w-sRG.js";import"./axios-DmypytPv.js";import"./moment-BjLXg0w5.js";import"./module-CQZTknZZ.js";function Le(){var S,q,F,R,$,L,A,T,P,M,V,E,I,W,_,O,z,H;const k=te(),g=ce({}),J=window.location.search,i=new URLSearchParams(J).get("id"),{resultList:K}=le("4-1-2022"),{getConsumerAddFormData:b}=de(),{getAllUser:N}=ne(),Q=ee().shape({wardNo:d().required().label("Ward no"),apartmentId:d().required().label("Choose Apartment"),consumerName:d().required().label("Consumer name"),mobileNo:d().required().label("Mobile no"),consumerCategory:d().required().label("Consumer category"),consumerType:d().required().label("Consumer type"),demandFrom:d().required().label("Demand from"),firmName:d().when("consumerCategory",{is:"2",then:()=>d().required().label("Firm name")}),licenseNo:d().when("consumerCategory",{is:"2",then:()=>d().required().label("License no")}),address:d(),pinCode:d()}),t=ae({resolver:se(Q),defaultValues:{wardNo:"",apartmentId:"",address:"",pinCode:"",consumerName:"",mobileNo:"",consumerCategory:"",consumerType:"",demandFrom:"",firmName:"",licenseNo:""}}),r=w({api:`${h.getApartmentDetailsById}/${i}`,options:{enabled:!!i}}),v=C.useMemo(()=>{var a,o,s,m,l,c,u,U;return{wardNo:`${(o=(a=r==null?void 0:r.data)==null?void 0:a.data[0])==null?void 0:o.wardNo}`??"",apartmentId:`${(m=(s=r==null?void 0:r.data)==null?void 0:s.data[0])==null?void 0:m.id}`??"",address:((c=(l=r==null?void 0:r.data)==null?void 0:l.data[0])==null?void 0:c.address)??"",pinCode:((U=(u=r==null?void 0:r.data)==null?void 0:u.data[0])==null?void 0:U.pinCode)??"",consumerName:"",mobileNo:"",consumerCategory:"",consumerType:"",demandFrom:"",firmName:"",licenseNo:""}},[(q=(S=r==null?void 0:r.data)==null?void 0:S.data[0])==null?void 0:q.id,(R=(F=r==null?void 0:r.data)==null?void 0:F.data[0])==null?void 0:R.wardNo]);C.useEffect(()=>{i&&t.reset(v)},[i,v]);const{consumerCategoryData:j}=oe(String(t.watch("consumerCategory"))),f=w({api:`${h.getApartmentListByWardNo}/${t.watch("wardNo")}`,options:{enabled:!!t.watch("wardNo")}}),n=w({api:`${h.getApartmentDetailsById}/${t.watch("apartmentId")}`,options:{enabled:!!t.watch("apartmentId")}});C.useEffect(()=>{var a,o,s,m,l,c,u;(o=(a=n==null?void 0:n.data)==null?void 0:a.data)!=null&&o[0]&&(t.setValue("address",`${(l=(m=(s=n==null?void 0:n.data)==null?void 0:s.data)==null?void 0:m[0])==null?void 0:l.address}`),t.setValue("pinCode",(u=(c=n==null?void 0:n.data)==null?void 0:c.data[0])==null?void 0:u.pinCode))},[(L=($=n==null?void 0:n.data)==null?void 0:$.data)==null?void 0:L[0]]);const X=async a=>{Z("Are you sure?","Please confirm",async()=>{var o;try{const s=await(g==null?void 0:g.mutateAsync({api:(o=h)==null?void 0:o.postConsumerAdd,data:a}));s!=null&&s.data.status?(y.success(s==null?void 0:s.data.msg),k(`/deoghar-app/apartment-actions/${t.watch("apartmentId")}`)):y.error(s==null?void 0:s.data.msg)}catch{y.error("Something went wrong")}})};return e.jsxs(B,{title:"Add Flats",children:[g.isPending&&e.jsx(ue,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(ie,{src:"/assets/image/category.png",alt:"Add Flats",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"font-semibold",children:"Add flats"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Solid waste management system",t.watch("address")]})]})]}),e.jsx(me,{}),e.jsx(G,{children:e.jsx(D,{children:e.jsxs(re,{methods:t,onSubmit:t.handleSubmit(X),children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("div",{children:e.jsx(p,{isRequired:!0,disabled:!!i,name:"wardNo",label:"Ward No",data:((P=(T=(A=N==null?void 0:N.data)==null?void 0:A.data[0].ulbDetails[0])==null?void 0:T.wards)==null?void 0:P.map(a=>({label:String(a),value:String(a)})))??[]})}),e.jsx("div",{children:e.jsx(p,{isRequired:!0,disabled:!!i,name:"apartmentId",label:"Choose Apartment",data:((E=(V=(M=f==null?void 0:f.data)==null?void 0:M.data)==null?void 0:V.apartmentList)==null?void 0:E.map(a=>({label:String(a.apt_name),value:String(a.id)})))??[]})}),e.jsx("div",{children:e.jsx(p,{isRequired:!0,name:"consumerCategory",label:"Consumer Category",data:((_=(W=(I=b==null?void 0:b.data)==null?void 0:I.data)==null?void 0:W.consumerCategory)==null?void 0:_.map(a=>({label:String(a.name),value:String(a.id)})))??[]})}),e.jsx("div",{children:e.jsx(p,{isRequired:!0,name:"consumerType",label:"Consumer Type",data:((H=(z=(O=j==null?void 0:j.data)==null?void 0:O.data)==null?void 0:z.consumerTypeList)==null?void 0:H.map(a=>({label:String(a.name),value:String(a.id)})))??[]})}),{2:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(x,{isRequired:!0,name:"firmName",label:"Firm Name",type:"text"})}),e.jsx("div",{children:e.jsx(x,{name:"licenseNo",isRequired:!0,label:"License No",type:"text"})})]})}[t.watch("consumerCategory")],e.jsx("div",{children:e.jsx(x,{name:"consumerName",isRequired:!0,label:"Consumer Name",type:"text",inputValidation:["removeDoubleSpace"]})}),e.jsx("div",{children:e.jsx(x,{type:"number",isRequired:!0,name:"mobileNo",label:"Mobile No",inputValidation:["mobile","number"]})}),e.jsx("div",{children:e.jsx(p,{name:"demandFrom",isRequired:!0,label:"Demand From",data:K.map(a=>({label:String(a.str),value:String(a.str)}))??[]})})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(Y,{type:"submit",variant:"default",size:"sm",className:"rounded-md w-24",children:"Add"})})]})})})]})]})}export{Le as default};
