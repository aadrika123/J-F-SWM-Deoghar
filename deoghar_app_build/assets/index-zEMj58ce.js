import{d as o,j as e,B as Ne,C as ye,g as re,F as le,_ as me}from"./index-CuInqoRq.js";import{h as oe}from"./moment-BjLXg0w5.js";import{u as be,o as ge,F as fe,S as ce,c as ve,a as r}from"./SelectField-BhHroWGw.js";import{R as l}from"./RHFTextField-wMCrq3QB.js";import{d as qe,h as we}from"./router-CTqkcgir.js";import{P as Ce}from"./index-CTfQp5AI.js";import{C as c,b as h}from"./card-BlUMd8-Z.js";import{T as Me,a as Re,b as he,c as j,d as Ue,e as u,H as De}from"./table-WYiv_0y0.js";import{u as Pe,b as Ae,a as xe}from"./useCustomQuery-LX2FaTUZ.js";import{S as N}from"./separator-B2XlZ15G.js";import{S as y}from"./SkeletonLoader-Be-ph_mH.js";import{I as Se}from"./Image-CnV_2Eia.js";import{O as ke}from"./OverLayLoader-rjfHngDA.js";import"./headlessui-BV7w-sRG.js";import"./axios-DmypytPv.js";import"./module-CZOxRCJ5.js";const Ie=ve().shape({paymentMode:r().required("Payment mode is required"),paidUpto:r().required("Payment amount is required"),bankName:r().when("paymentMode",{is:d=>d=="Cheque"||d=="Dd",then:()=>r().required("Bank name is required")}),branchName:r().when("paymentMode",{is:d=>d=="Cheque"||d=="Dd",then:()=>r().required("Branch name is required")}),chequeDate:r().when("paymentMode",{is:d=>d=="Cheque"||d=="Dd",then:()=>r().required("Cheque/DD date is required")}),chequeNo:r().when("paymentMode",{is:d=>d=="Cheque"||d=="Dd",then:()=>r().required("Cheque/DD number is required")})});function Ge(){var b,g,f,v,q,w,C,M,R,U,D,P,A,S,k,I,_,B,F,T,L,Y,O,E,H,$,W,Q,V,J,K,z;const d=qe(),{mutateAsync:pe,isPending:je}=Pe({}),{id:i}=we(),a=Ae({api:`${o.getConsumerDetailsById}/${i}`,options:{enabled:!!i}}),m=be({resolver:ge(Ie)}),x=xe({api:o.getPaymentData,config:{consumerId:i},options:{enabled:!!i}}),n=xe({api:o.getCalculatedAmount,config:{consumerId:i,payUpto:m.watch("paidUpto")},value:[m.watch("paidUpto")],options:{enabled:!!m.watch("paidUpto")&&!!i}}),ue=async s=>{ye("Are you sure to pay?","Please confirm",async()=>{var p,G,X,Z,ee,ae,se,de,te,ie,ne;try{if((s==null?void 0:s.paymentMode)=="Card"){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:(G=(p=n.data)==null?void 0:p.data)==null?void 0:G.totaldemand,consumerId:i,paidUpto:s.paidUpto,paymentMode:s.paymentMode,api:re+o.postPayment,token:localStorage.getItem("token"),redirectUrl:le+"/deoghar-app/payment-receipt",payload:{consumerId:i,paidAmount:(X=n.data)==null?void 0:X.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto}}}));return}if((s==null?void 0:s.paymentMode)=="QR"){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:(ee=(Z=n.data)==null?void 0:Z.data)==null?void 0:ee.totaldemand,consumerId:i,paidUpto:s.paidUpto,paymentMode:s.paymentMode,api:re+o.postPayment,token:localStorage.getItem("token"),redirectUrl:le+"/deoghar-app/payment-receipt",payload:{consumerId:i,paidAmount:(ae=n.data)==null?void 0:ae.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto}}}));return}else{const t=await pe({api:o.postPayment,data:s.paymentMode==="Cash"?{consumerId:i,paidAmount:(se=n.data)==null?void 0:se.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto}:{consumerId:i,paidAmount:(de=n.data)==null?void 0:de.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto,bankName:s.bankName,branchName:s.branchName,chequeNo:s.chequeNo,chequeDate:s.chequeDate}});(te=t==null?void 0:t.data)!=null&&te.status?(me.success(t==null?void 0:t.data.msg),d(`/deoghar-app/payment-receipt/${(ne=(ie=t==null?void 0:t.data)==null?void 0:ie.data)==null?void 0:ne.transactionNo}`,{replace:!0})):me.error(t==null?void 0:t.data.msg)}}catch{}})};return a!=null&&a.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(c,{children:e.jsxs(h,{children:[e.jsx(y,{}),e.jsx(y,{}),e.jsx(y,{})]})})}):e.jsxs(Ce,{title:"Consumer Payment",children:[je&&e.jsx(ke,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(Se,{src:"/assets/image/category.png",alt:"Consumer Payment",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"font-semibold",children:"Consumer Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Consumer payment details here."})]})]}),e.jsx(N,{}),e.jsx(c,{children:e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(g=(b=a==null?void 0:a.data)==null?void 0:b.data[0])==null?void 0:g.consumerNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(v=(f=a==null?void 0:a.data)==null?void 0:f.data[0])==null?void 0:v.consumerName})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Mobile:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(w=(q=a==null?void 0:a.data)==null?void 0:q.data[0])==null?void 0:w.mobileNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(M=(C=a==null?void 0:a.data)==null?void 0:C.data[0])==null?void 0:M.monthlyDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(U=(R=a==null?void 0:a.data)==null?void 0:R.data[0])==null?void 0:U.totalDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand upto:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(P=(D=a==null?void 0:a.data)==null?void 0:D.data[0])==null?void 0:P.demandUpto})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand from:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(S=(A=a==null?void 0:a.data)==null?void 0:A.data[0])==null?void 0:S.demandFrom})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer type:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=(k=a==null?void 0:a.data)==null?void 0:k.data[0])==null?void 0:I.cansumerType})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(B=(_=a==null?void 0:a.data)==null?void 0:_.data[0])==null?void 0:B.Address})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply Date:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(T=(F=a==null?void 0:a.data)==null?void 0:F.data[0])==null?void 0:T.applyDate})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply By:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(Y=(L=a==null?void 0:a.data)==null?void 0:L.data[0])==null?void 0:Y.applyBy})})]})})}),e.jsx(N,{}),((H=(E=(O=a==null?void 0:a.data)==null?void 0:O.data[0])==null?void 0:E.activeDemandDetails)==null?void 0:H.length)>0?e.jsxs(e.Fragment,{children:[" ",e.jsx(c,{children:e.jsx(h,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(N,{}),e.jsx("div",{children:e.jsxs(Me,{children:[e.jsx(Re,{children:e.jsxs(he,{children:[e.jsx(j,{children:"Demand from"}),e.jsx(j,{children:"Demand upto"}),e.jsx(j,{children:"Amount"}),e.jsx(j,{children:"Status"})]})}),e.jsx(Ue,{children:(Q=(W=($=a==null?void 0:a.data)==null?void 0:$.data[0])==null?void 0:W.activeDemandDetails)==null?void 0:Q.map((s,p)=>e.jsxs(he,{children:[e.jsx(u,{children:oe(s.payment_from).format("DD-MMM-YYYY")}),e.jsx(u,{children:oe(s.payment_to).format("DD-MMM-YYYY")}),e.jsx(u,{children:s.total_tax}),e.jsx(u,{children:s.paid_status==0?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},p+1))})]})})]})})}),e.jsx(N,{}),e.jsx(c,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(h,{children:e.jsxs(fe,{methods:m,onSubmit:m.handleSubmit(ue),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(ce,{isRequired:!0,name:"paidUpto",label:"Payment Amount",className:"w-full",data:((K=(J=(V=x==null?void 0:x.data)==null?void 0:V.data)==null?void 0:J.demand)==null?void 0:K.map(s=>({label:String(s.payment_to),value:String(s.payment_to)})))??[]})}),e.jsx("div",{children:e.jsx(ce,{isRequired:!0,name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Card",value:"Card"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(l,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{isRequired:!0,name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{isRequired:!0,type:"date",name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(l,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{isRequired:!0,name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(l,{isRequired:!0,name:"chequeDate",type:"date",label:"DD Date",className:"w-full"})})]})}[m.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(Ne,{type:"submit",className:"mx-auto",disabled:n.isLoading||x.isLoading,children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),n!=null&&n.isLoading?"Calculating...":`Pay Now ₹ ${((z=n.data)==null?void 0:z.data.totaldemand)??0}`]})})]})})})]}):e.jsx(c,{children:e.jsx(h,{children:e.jsx("div",{className:"py-2 flex justify-center items-center",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{Ge as default};
